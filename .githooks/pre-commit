#!/bin/sh

# Block pip install outside virtual environment
if git diff --cached --name-only | grep -q -E "(requirements\.txt|setup\.py|pyproject\.toml)"; then
  if [ -z "$VIRTUAL_ENV" ]; then
    echo "ERROR: Attempting to modify dependencies outside virtual environment!" >&2
    echo "Use: .venv\\Scripts\\python -m pip install <package>" >&2
    exit 1
  fi
fi

# Block direct pip install commands in commit
if git diff --cached --diff-filter=AM -p | grep -q -E "^\+.*pip install"; then
  if [ -z "$VIRTUAL_ENV" ]; then
    echo "ERROR: 'pip install' detected outside virtual environment!" >&2
    echo "Use: .venv\\Scripts\\python -m pip install <package>" >&2
    exit 1
  fi
fi

exit 0
