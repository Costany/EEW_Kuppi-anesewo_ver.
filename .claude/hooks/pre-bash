#!/bin/bash
# Claude Code Hook: Prevent pip installs outside virtual environment
# This hook ensures all pip commands use the virtual environment

COMMAND="$*"

# Check if command contains pip installation
if echo "$COMMAND" | grep -qE "pip\s+install|pip3\s+install|python\s+-m\s+pip.*install"; then
    # Check if VIRTUAL_ENV is set (indicates active virtual environment)
    if [ -z "$VIRTUAL_ENV" ]; then
        # Check if using explicit venv python path (Windows or Unix)
        if ! echo "$COMMAND" | grep -qE "\.venv[\\\/](Scripts|bin)[\\\/]python"; then
            echo "‚ùå ERROR: pip install detected without virtual environment!"
            echo ""
            echo "Virtual environment is NOT activated. Please use one of these options:"
            echo ""
            echo "Option 1: Activate virtual environment first"
            echo "  Windows:  .venv\\Scripts\\activate"
            echo "  macOS/Linux: source .venv/bin/activate"
            echo "  Then run: pip install package_name"
            echo ""
            echo "Option 2: Use virtual environment Python directly (recommended for Claude Code)"
            echo "  Windows:  .venv\\Scripts\\python -m pip install package_name"
            echo "  macOS/Linux: .venv/bin/python -m pip install package_name"
            echo ""
            exit 1
        fi
    fi
fi

# If checks pass, allow command to proceed
exit 0
